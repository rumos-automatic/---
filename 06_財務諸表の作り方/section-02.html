<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>6.2 損益計算書（P/L）の作り方 | 会社事業における融資と利益の理解</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">

  <!-- ナビゲーション -->
  <nav class="bg-white shadow-md fixed top-0 left-0 right-0 z-50">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <a href="../index.html" class="text-lg md:text-xl font-bold text-blue-600 hover:text-blue-800 transition">
        ← トップページ
      </a>
      <div class="flex gap-4">
        <a href="section-01.html" class="text-lg md:text-xl text-blue-600 hover:text-blue-800 transition">
          ← 前のセクション
        </a>
        <a href="section-03.html" class="text-lg md:text-xl text-blue-600 hover:text-blue-800 transition">
          次のセクション →
        </a>
      </div>
    </div>
  </nav>

  <!-- ドットインジケーター -->
  <div class="fixed left-8 top-1/2 transform -translate-y-1/2 z-40 hidden lg:block">
    <div class="flex flex-col gap-4">
      <div class="dot-item group relative" data-target="intro">
        <div class="w-3 h-3 rounded-full bg-gray-300 cursor-pointer transition-all group-hover:bg-blue-500"></div>
        <span class="absolute right-6 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white px-3 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap text-sm">
          導入
        </span>
      </div>
      <div class="dot-item group relative" data-target="structure">
        <div class="w-3 h-3 rounded-full bg-gray-300 cursor-pointer transition-all group-hover:bg-blue-500"></div>
        <span class="absolute right-6 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white px-3 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap text-sm">
          基本構造
        </span>
      </div>
      <div class="dot-item group relative" data-target="steps">
        <div class="w-3 h-3 rounded-full bg-gray-300 cursor-pointer transition-all group-hover:bg-blue-500"></div>
        <span class="absolute right-6 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white px-3 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap text-sm">
          作成ステップ
        </span>
      </div>
      <div class="dot-item group relative" data-target="calculator">
        <div class="w-3 h-3 rounded-full bg-gray-300 cursor-pointer transition-all group-hover:bg-blue-500"></div>
        <span class="absolute right-6 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white px-3 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap text-sm">
          P/L自動計算ツール
        </span>
      </div>
      <div class="dot-item group relative" data-target="summary">
        <div class="w-3 h-3 rounded-full bg-gray-300 cursor-pointer transition-all group-hover:bg-blue-500"></div>
        <span class="absolute right-6 top-1/2 transform -translate-y-1/2 bg-gray-800 text-white px-3 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap text-sm">
          まとめ
        </span>
      </div>
    </div>
  </div>

  <!-- メインコンテンツ -->
  <main class="container mx-auto px-4 py-24 max-w-4xl">

    <!-- セクションタイトル -->
    <h1 class="text-5xl md:text-6xl font-bold mb-8 text-gray-900">6.2 損益計算書（P/L）の作り方</h1>

    <!-- 導入 -->
    <section id="intro" class="mb-16 scroll-mt-24">
      <p class="text-lg md:text-xl mb-4 leading-relaxed">
        それでは、実際に損益計算書（P/L）を作成してみましょう。
        P/Lは、売上から費用を差し引いて利益を計算する表です。
      </p>
      <p class="text-lg md:text-xl mb-4 leading-relaxed">
        このセクションでは、9つのステップに分けて、P/Lの作り方を詳しく解説します。
        具体的な数値例を使って、実際の計算過程を見ていきましょう。
      </p>
    </section>

    <!-- 基本構造 -->
    <section id="structure" class="mb-16 scroll-mt-24">
      <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gray-900">基本構造（おさらい）</h2>

      <div class="bg-blue-50 p-6 rounded-lg shadow-lg mb-6">
        <h3 class="text-xl md:text-2xl font-bold text-blue-800 mb-4">損益計算書の構造</h3>
        <pre class="text-lg md:text-xl text-blue-900 font-mono leading-relaxed overflow-x-auto">
売上高                    1,000万円
- 売上原価                  600万円
--------------------------------
= 売上総利益（粗利）         400万円
- 販売費及び一般管理費       300万円
--------------------------------
= 営業利益                  100万円
+ 営業外収益                  5万円
- 営業外費用                 10万円
--------------------------------
= 経常利益                   95万円
+/- 特別損益                  0万円
--------------------------------
= 税引前当期純利益           95万円
- 法人税等                   25万円
--------------------------------
= 当期純利益                 70万円
        </pre>
      </div>

      <p class="text-lg md:text-xl mb-6 leading-relaxed">
        この構造に沿って、順番に計算していきます。
        各ステップで必要な情報を集めて、上から順に埋めていくイメージです。
      </p>
    </section>

    <!-- 作成ステップ -->
    <section id="steps" class="mb-16 scroll-mt-24">
      <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gray-900">P/L作成の9つのステップ</h2>

      <!-- ステップ1 -->
      <div class="bg-white shadow-md rounded-lg p-6 mb-6">
        <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">ステップ1：売上高の集計</h3>
        <p class="text-lg md:text-xl text-gray-700 mb-4">
          レジや売上台帳から、期間中の売上を集計します。
          返品や値引きがあれば差し引きます。
        </p>
        <div class="bg-gray-50 p-4 rounded mb-4">
          <p class="text-lg md:text-xl text-gray-800 font-bold mb-2">記入例：</p>
          <ul class="list-disc pl-6 text-lg md:text-xl text-gray-700 space-y-2">
            <li>商品A売上：300万円</li>
            <li>商品B売上：500万円</li>
            <li>サービス売上：200万円</li>
            <li class="font-bold">→ 合計：1,000万円</li>
          </ul>
        </div>
      </div>

      <!-- ステップ2 -->
      <div class="bg-white shadow-md rounded-lg p-6 mb-6">
        <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">ステップ2：売上原価の計算</h3>
        <p class="text-lg md:text-xl text-gray-700 mb-4">
          売上原価は、売れた商品の仕入れ代金です。
          以下の公式で計算します。
        </p>
        <div class="bg-blue-50 p-4 rounded mb-4">
          <p class="text-lg md:text-xl text-blue-900 font-bold">
            売上原価 = 期首在庫 + 当期仕入 - 期末在庫
          </p>
        </div>
        <div class="bg-gray-50 p-4 rounded mb-4">
          <p class="text-lg md:text-xl text-gray-800 font-bold mb-2">例：</p>
          <ul class="list-disc pl-6 text-lg md:text-xl text-gray-700 space-y-2">
            <li>期首在庫：50万円</li>
            <li>当期仕入：600万円</li>
            <li>期末在庫：50万円</li>
            <li class="font-bold">→ 売上原価：600万円</li>
          </ul>
        </div>
      </div>

      <!-- ステップ3 -->
      <div class="bg-white shadow-md rounded-lg p-6 mb-6">
        <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">ステップ3：売上総利益の計算</h3>
        <p class="text-lg md:text-xl text-gray-700 mb-4">
          売上総利益（粗利）は、売上から売上原価を引いて計算します。
        </p>
        <div class="bg-blue-50 p-4 rounded mb-4">
          <p class="text-lg md:text-xl text-blue-900 font-bold mb-2">
            売上総利益 = 売上高 - 売上原価
          </p>
          <p class="text-lg md:text-xl text-blue-900">
            = 1,000万円 - 600万円 = 400万円
          </p>
        </div>
        <div class="bg-gray-50 p-4 rounded">
          <p class="text-lg md:text-xl text-gray-800 font-bold mb-2">粗利率も計算：</p>
          <p class="text-lg md:text-xl text-gray-700">
            粗利率 = 400万円 ÷ 1,000万円 = 40%
          </p>
        </div>
      </div>

      <!-- ステップ4 -->
      <div class="bg-white shadow-md rounded-lg p-6 mb-6">
        <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">ステップ4：販管費の集計</h3>
        <p class="text-lg md:text-xl text-gray-700 mb-4">
          販売費及び一般管理費（販管費）は、事業を運営するために必要な経費です。
        </p>
        <div class="bg-gray-50 p-4 rounded mb-4">
          <p class="text-lg md:text-xl text-gray-800 font-bold mb-2">主な販管費：</p>
          <ul class="list-disc pl-6 text-lg md:text-xl text-gray-700 space-y-2">
            <li>人件費（給料、社会保険料）：150万円</li>
            <li>家賃：50万円</li>
            <li>広告費：30万円</li>
            <li>通信費、消耗品費、水道光熱費など：70万円</li>
            <li class="font-bold">→ 合計：300万円</li>
          </ul>
        </div>
      </div>

      <!-- ステップ5 -->
      <div class="bg-white shadow-md rounded-lg p-6 mb-6">
        <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">ステップ5：営業利益の計算</h3>
        <p class="text-lg md:text-xl text-gray-700 mb-4">
          営業利益は、本業で稼いだ利益です。
        </p>
        <div class="bg-blue-50 p-4 rounded mb-4">
          <p class="text-lg md:text-xl text-blue-900 font-bold mb-2">
            営業利益 = 売上総利益 - 販管費
          </p>
          <p class="text-lg md:text-xl text-blue-900">
            = 400万円 - 300万円 = 100万円
          </p>
        </div>
      </div>

      <!-- ステップ6 -->
      <div class="bg-white shadow-md rounded-lg p-6 mb-6">
        <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">ステップ6：営業外損益の計算</h3>
        <p class="text-lg md:text-xl text-gray-700 mb-4">
          営業外損益は、本業以外の収益と費用です。
        </p>
        <div class="bg-gray-50 p-4 rounded mb-4">
          <p class="text-lg md:text-xl text-gray-800 font-bold mb-2">営業外収益：</p>
          <ul class="list-disc pl-6 text-lg md:text-xl text-gray-700 space-y-2 mb-4">
            <li>受取利息：1万円</li>
            <li>雑収入：4万円</li>
            <li class="font-bold">→ 合計：5万円</li>
          </ul>
          <p class="text-lg md:text-xl text-gray-800 font-bold mb-2">営業外費用：</p>
          <ul class="list-disc pl-6 text-lg md:text-xl text-gray-700 space-y-2">
            <li>支払利息（融資の利息）：10万円</li>
            <li class="font-bold">→ 合計：10万円</li>
          </ul>
        </div>
        <div class="bg-orange-50 border-l-4 border-orange-500 p-4 rounded">
          <p class="text-lg md:text-xl text-orange-900">
            <span class="font-bold">注意：</span>融資の利息は「営業外費用」に計上します。販管費には含めません。
          </p>
        </div>
      </div>

      <!-- ステップ7 -->
      <div class="bg-white shadow-md rounded-lg p-6 mb-6">
        <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">ステップ7：経常利益の計算</h3>
        <p class="text-lg md:text-xl text-gray-700 mb-4">
          経常利益は、通常の事業活動で稼いだ利益です。
        </p>
        <div class="bg-blue-50 p-4 rounded mb-4">
          <p class="text-lg md:text-xl text-blue-900 font-bold mb-2">
            経常利益 = 営業利益 + 営業外収益 - 営業外費用
          </p>
          <p class="text-lg md:text-xl text-blue-900">
            = 100万円 + 5万円 - 10万円 = 95万円
          </p>
        </div>
      </div>

      <!-- ステップ8 -->
      <div class="bg-white shadow-md rounded-lg p-6 mb-6">
        <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">ステップ8：税金の計算</h3>
        <p class="text-lg md:text-xl text-gray-700 mb-4">
          法人税等は、税引前利益に税率をかけて計算します。
        </p>
        <div class="bg-blue-50 p-4 rounded mb-4">
          <p class="text-lg md:text-xl text-blue-900 font-bold mb-2">
            法人税等 = 税引前利益 × 税率
          </p>
          <p class="text-lg md:text-xl text-blue-900">
            = 95万円 × 約26% ≒ 25万円
          </p>
        </div>
        <p class="text-lg md:text-xl text-gray-600 italic">
          ※実際の税率は所得により異なります。詳しくは税理士にご相談ください。
        </p>
      </div>

      <!-- ステップ9 -->
      <div class="bg-white shadow-md rounded-lg p-6 mb-6">
        <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">ステップ9：当期純利益の計算</h3>
        <p class="text-lg md:text-xl text-gray-700 mb-4">
          当期純利益は、最終的な利益です。
        </p>
        <div class="bg-green-50 p-4 rounded mb-4">
          <p class="text-lg md:text-xl text-green-900 font-bold mb-2">
            当期純利益 = 税引前利益 - 法人税等
          </p>
          <p class="text-lg md:text-xl text-green-900">
            = 95万円 - 25万円 = 70万円
          </p>
        </div>
        <p class="text-lg md:text-xl text-gray-700">
          この70万円が、会社の純資産として積み上がります。
        </p>
      </div>
    </section>

    <!-- P/L自動計算ツール -->
    <section id="calculator" class="mb-16 scroll-mt-24">
      <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gray-900">P/L自動計算ツール</h2>

      <p class="text-lg md:text-xl mb-6 leading-relaxed">
        実際に数値を入力して、P/Lを作成してみましょう。
        以下のツールに数値を入力すると、自動的に計算結果が表示されます。
      </p>

      <div class="bg-white shadow-lg rounded-lg p-6 mb-6">
        <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">売上・原価の入力</h3>
        <div class="grid md:grid-cols-2 gap-4 mb-6">
          <div>
            <label class="block text-lg md:text-xl mb-2 text-gray-700">売上高（円）</label>
            <input type="number" id="sales" class="w-full border-2 border-blue-300 rounded px-4 py-3 text-lg focus:border-blue-500 focus:outline-none" placeholder="10000000" value="10000000">
          </div>
          <div>
            <label class="block text-lg md:text-xl mb-2 text-gray-700">売上原価（円）</label>
            <input type="number" id="cogs" class="w-full border-2 border-blue-300 rounded px-4 py-3 text-lg focus:border-blue-500 focus:outline-none" placeholder="6000000" value="6000000">
          </div>
        </div>

        <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">経費の入力</h3>
        <div class="grid md:grid-cols-2 gap-4 mb-6">
          <div>
            <label class="block text-lg md:text-xl mb-2 text-gray-700">販売費及び一般管理費（円）</label>
            <input type="number" id="expenses" class="w-full border-2 border-blue-300 rounded px-4 py-3 text-lg focus:border-blue-500 focus:outline-none" placeholder="3000000" value="3000000">
          </div>
          <div>
            <label class="block text-lg md:text-xl mb-2 text-gray-700">営業外収益（円）</label>
            <input type="number" id="nonOpIncome" class="w-full border-2 border-blue-300 rounded px-4 py-3 text-lg focus:border-blue-500 focus:outline-none" placeholder="50000" value="50000">
          </div>
        </div>

        <div class="grid md:grid-cols-2 gap-4 mb-6">
          <div>
            <label class="block text-lg md:text-xl mb-2 text-gray-700">営業外費用（円）</label>
            <input type="number" id="nonOpExpense" class="w-full border-2 border-blue-300 rounded px-4 py-3 text-lg focus:border-blue-500 focus:outline-none" placeholder="100000" value="100000">
          </div>
          <div>
            <label class="block text-lg md:text-xl mb-2 text-gray-700">税率（%）</label>
            <input type="number" id="taxRate" class="w-full border-2 border-blue-300 rounded px-4 py-3 text-lg focus:border-blue-500 focus:outline-none" placeholder="26" value="26" step="0.1">
          </div>
        </div>

        <button onclick="calculatePL()" class="w-full bg-blue-600 text-white text-lg md:text-xl px-6 py-4 rounded-lg hover:bg-blue-700 transition shadow-lg font-bold">
          計算する
        </button>
      </div>

      <!-- 計算結果 -->
      <div id="result" class="bg-green-50 border-2 border-green-500 rounded-lg p-6 hidden">
        <h3 class="text-xl md:text-2xl font-bold text-green-700 mb-4">計算結果</h3>
        <div class="space-y-3">
          <div class="flex justify-between border-b border-green-300 pb-2">
            <span class="text-lg md:text-xl text-green-900 font-bold">売上高</span>
            <span class="text-lg md:text-xl text-green-900" id="resultSales"></span>
          </div>
          <div class="flex justify-between border-b border-green-300 pb-2">
            <span class="text-lg md:text-xl text-green-900">売上原価</span>
            <span class="text-lg md:text-xl text-green-900" id="resultCogs"></span>
          </div>
          <div class="flex justify-between border-b border-green-300 pb-2">
            <span class="text-lg md:text-xl text-green-900 font-bold">売上総利益（粗利）</span>
            <span class="text-lg md:text-xl text-green-900 font-bold" id="resultGrossProfit"></span>
          </div>
          <div class="flex justify-between border-b border-green-300 pb-2">
            <span class="text-lg md:text-xl text-green-900">粗利率</span>
            <span class="text-lg md:text-xl text-green-900" id="resultGrossMargin"></span>
          </div>
          <div class="flex justify-between border-b border-green-300 pb-2">
            <span class="text-lg md:text-xl text-green-900">販売費及び一般管理費</span>
            <span class="text-lg md:text-xl text-green-900" id="resultExpenses"></span>
          </div>
          <div class="flex justify-between border-b border-green-300 pb-2">
            <span class="text-lg md:text-xl text-green-900 font-bold">営業利益</span>
            <span class="text-lg md:text-xl text-green-900 font-bold" id="resultOperatingIncome"></span>
          </div>
          <div class="flex justify-between border-b border-green-300 pb-2">
            <span class="text-lg md:text-xl text-green-900">営業外収益</span>
            <span class="text-lg md:text-xl text-green-900" id="resultNonOpIncome"></span>
          </div>
          <div class="flex justify-between border-b border-green-300 pb-2">
            <span class="text-lg md:text-xl text-green-900">営業外費用</span>
            <span class="text-lg md:text-xl text-green-900" id="resultNonOpExpense"></span>
          </div>
          <div class="flex justify-between border-b border-green-300 pb-2">
            <span class="text-lg md:text-xl text-green-900 font-bold">経常利益</span>
            <span class="text-lg md:text-xl text-green-900 font-bold" id="resultOrdinaryIncome"></span>
          </div>
          <div class="flex justify-between border-b border-green-300 pb-2">
            <span class="text-lg md:text-xl text-green-900">法人税等</span>
            <span class="text-lg md:text-xl text-green-900" id="resultTax"></span>
          </div>
          <div class="flex justify-between pt-2">
            <span class="text-lg md:text-xl text-green-900 font-bold">当期純利益</span>
            <span class="text-lg md:text-xl text-green-900 font-bold text-2xl" id="resultNetIncome"></span>
          </div>
        </div>
      </div>

      <div class="mt-6 bg-blue-50 border-l-4 border-blue-500 p-6 rounded-r">
        <h3 class="text-xl md:text-2xl font-bold text-blue-800 mb-3">ダウンロード</h3>
        <p class="text-lg md:text-xl text-blue-900 mb-4">
          Excelテンプレートをダウンロードして、実際にP/Lを作成してみましょう。
        </p>
        <a href="../../assets/templates/月次損益計算書.xlsx" class="inline-block bg-blue-600 text-white text-lg px-6 py-3 rounded hover:bg-blue-700 transition">
          月次損益計算書テンプレート (.xlsx)
        </a>
      </div>
    </section>

    <!-- まとめ -->
    <section id="summary" class="mb-16 scroll-mt-24">
      <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gray-900">このセクションのまとめ</h2>

      <p class="text-lg md:text-xl mb-6 leading-relaxed">
        P/Lの作り方について、理解が深まったでしょうか？
        9つのステップを順に進めれば、誰でもP/Lを作成できます。
      </p>

      <div class="grid md:grid-cols-2 gap-6 mb-8">
        <div class="bg-blue-50 p-6 rounded-lg shadow">
          <h3 class="text-xl md:text-2xl font-bold text-blue-800 mb-3">✓ 売上→原価→粗利</h3>
          <p class="text-lg md:text-xl text-blue-900">
            売上高から売上原価を引いて、売上総利益を計算します。
          </p>
        </div>

        <div class="bg-blue-50 p-6 rounded-lg shadow">
          <h3 class="text-xl md:text-2xl font-bold text-blue-800 mb-3">✓ 粗利→経費→営業利益</h3>
          <p class="text-lg md:text-xl text-blue-900">
            売上総利益から販管費を引いて、営業利益を計算します。
          </p>
        </div>

        <div class="bg-blue-50 p-6 rounded-lg shadow">
          <h3 class="text-xl md:text-2xl font-bold text-blue-800 mb-3">✓ 営業外損益→経常利益</h3>
          <p class="text-lg md:text-xl text-blue-900">
            営業外収益・費用を加減して、経常利益を計算します。
          </p>
        </div>

        <div class="bg-blue-50 p-6 rounded-lg shadow">
          <h3 class="text-xl md:text-2xl font-bold text-blue-800 mb-3">✓ 税金→当期純利益</h3>
          <p class="text-lg md:text-xl text-blue-900">
            税金を差し引いて、最終的な当期純利益を計算します。
          </p>
        </div>
      </div>

      <p class="text-lg md:text-xl leading-relaxed">
        次のセクションでは、「貸借対照表（B/S）の作り方」を学んでいきます。
        会社の財産状況を把握する重要な表です。
      </p>
    </section>

    <!-- 次のセクションへのリンク -->
    <div class="text-center mt-12">
      <a href="section-03.html" class="inline-block bg-blue-600 text-white text-lg md:text-xl px-8 py-4 rounded-lg hover:bg-blue-700 transition shadow-lg">
        次のセクションへ：6.3 貸借対照表（B/S）の作り方 →
      </a>
    </div>

  </main>

  <!-- 画像拡大モーダル -->
  <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50">
    <button id="closeModal" class="absolute top-4 right-4 text-white text-4xl hover:text-gray-300 transition">&times;</button>
    <img id="modalImage" class="max-w-full max-h-full p-4" src="" alt="">
  </div>

  <!-- スクリプト -->
  <script>
    // P/L計算ツール
    function calculatePL() {
      // 入力値を取得
      const sales = parseFloat(document.getElementById('sales').value) || 0;
      const cogs = parseFloat(document.getElementById('cogs').value) || 0;
      const expenses = parseFloat(document.getElementById('expenses').value) || 0;
      const nonOpIncome = parseFloat(document.getElementById('nonOpIncome').value) || 0;
      const nonOpExpense = parseFloat(document.getElementById('nonOpExpense').value) || 0;
      const taxRate = parseFloat(document.getElementById('taxRate').value) || 26;

      // バリデーション
      if (sales < 0 || cogs < 0 || expenses < 0) {
        alert('負の数は入力できません');
        return;
      }

      // 計算
      const grossProfit = sales - cogs;
      const grossMargin = sales > 0 ? (grossProfit / sales * 100).toFixed(1) : 0;
      const operatingIncome = grossProfit - expenses;
      const ordinaryIncome = operatingIncome + nonOpIncome - nonOpExpense;
      const tax = Math.max(0, Math.round(ordinaryIncome * (taxRate / 100)));
      const netIncome = ordinaryIncome - tax;

      // 結果を表示
      document.getElementById('resultSales').textContent = sales.toLocaleString() + '円';
      document.getElementById('resultCogs').textContent = cogs.toLocaleString() + '円';
      document.getElementById('resultGrossProfit').textContent = grossProfit.toLocaleString() + '円';
      document.getElementById('resultGrossMargin').textContent = grossMargin + '%';
      document.getElementById('resultExpenses').textContent = expenses.toLocaleString() + '円';
      document.getElementById('resultOperatingIncome').textContent = operatingIncome.toLocaleString() + '円';
      document.getElementById('resultNonOpIncome').textContent = nonOpIncome.toLocaleString() + '円';
      document.getElementById('resultNonOpExpense').textContent = nonOpExpense.toLocaleString() + '円';
      document.getElementById('resultOrdinaryIncome').textContent = ordinaryIncome.toLocaleString() + '円';
      document.getElementById('resultTax').textContent = tax.toLocaleString() + '円';
      document.getElementById('resultNetIncome').textContent = netIncome.toLocaleString() + '円';

      document.getElementById('result').classList.remove('hidden');

      // 結果までスクロール
      document.getElementById('result').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    // ドットインジケーター
    const dotItems = document.querySelectorAll('.dot-item');
    const sections = document.querySelectorAll('section[id]');

    // ドットクリックでスクロール
    dotItems.forEach(dot => {
      dot.addEventListener('click', () => {
        const target = dot.getAttribute('data-target');
        const targetSection = document.getElementById(target);
        if (targetSection) {
          targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });

    // スクロール時にドットをアクティブ化
    function updateActiveDot() {
      let current = '';
      sections.forEach(section => {
        const sectionTop = section.offsetTop;
        const sectionHeight = section.clientHeight;
        if (window.scrollY >= sectionTop - 200) {
          current = section.getAttribute('id');
        }
      });

      dotItems.forEach(dot => {
        const dotDiv = dot.querySelector('div');
        if (dot.getAttribute('data-target') === current) {
          dotDiv.classList.remove('bg-gray-300');
          dotDiv.classList.add('bg-blue-600', 'w-4', 'h-4');
        } else {
          dotDiv.classList.remove('bg-blue-600', 'w-4', 'h-4');
          dotDiv.classList.add('bg-gray-300');
        }
      });
    }

    window.addEventListener('scroll', updateActiveDot);
    updateActiveDot();

    // 画像拡大機能
    const modal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    const closeModal = document.getElementById('closeModal');

    // プレースホルダー画像をクリック可能にする場合
    document.querySelectorAll('img').forEach(img => {
      img.style.cursor = 'pointer';
      img.addEventListener('click', () => {
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        modalImage.src = img.src;
      });
    });

    closeModal.addEventListener('click', () => {
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    });

    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
      }
    });

    // Escキーでモーダルを閉じる
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
      }
    });
  </script>

</body>
</html>
