<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2.7 限界利益と貢献利益 | 会社事業における融資と利益の理解</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .dot-indicator { position: fixed; left: 2rem; top: 50%; transform: translateY(-50%); z-index: 40; }
    .dot { width: 12px; height: 12px; border-radius: 50%; background-color: #cbd5e1; margin: 1rem 0; cursor: pointer; transition: all 0.3s; position: relative; }
    .dot.active { background-color: #3b82f6; transform: scale(1.3); }
    .dot:hover { background-color: #3b82f6; transform: scale(1.2); }
    .dot-label { position: absolute; left: 2rem; top: 50%; transform: translateY(-50%); background-color: #1e293b; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.3s; font-size: 0.875rem; }
    .dot:hover .dot-label { opacity: 1; }
    @media (max-width: 768px) { .dot-indicator { display: none; } }
    html { scroll-behavior: smooth; }
  </style>
</head>
<body class="bg-gray-50">
  <nav class="bg-white shadow-md fixed top-0 left-0 right-0 z-50">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <a href="../index.html" class="text-lg md:text-xl font-bold text-blue-600 hover:text-blue-700">← トップページ</a>
      <div class="flex gap-4">
        <a href="section-06.html" class="text-lg md:text-xl text-blue-600 hover:text-blue-700">← 前のセクション</a>
        <a href="section-08.html" class="text-lg md:text-xl text-blue-600 hover:text-blue-700">次のセクション →</a>
      </div>
    </div>
  </nav>

  <div class="dot-indicator">
    <div class="dot active" data-target="intro"><div class="dot-label">限界利益とは</div></div>
    <div class="dot" data-target="importance"><div class="dot-label">なぜ重要か</div></div>
    <div class="dot" data-target="example"><div class="dot-label">具体例</div></div>
    <div class="dot" data-target="discount"><div class="dot-label">値引き判断</div></div>
    <div class="dot" data-target="calculator"><div class="dot-label">計算ツール</div></div>
    <div class="dot" data-target="summary"><div class="dot-label">まとめ</div></div>
  </div>

  <main class="container mx-auto px-4 py-24 max-w-4xl">
    <h1 class="text-5xl md:text-6xl font-bold mb-8 text-gray-800">2.7 限界利益と貢献利益</h1>

    <p class="text-lg md:text-xl mb-12 text-gray-700 leading-relaxed">
      限界利益は、管理会計で最も重要な概念の一つです。
      値引き判断、商品選定、経営戦略のすべてに関わる重要な指標を学んでいきましょう。
    </p>

    <section id="intro" class="mb-16 scroll-mt-24">
      <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gray-800">限界利益とは</h2>

      <div class="bg-green-50 p-8 rounded-lg mb-6 border-2 border-green-500">
        <h3 class="text-xl md:text-2xl font-bold text-green-700 mb-4 text-center">限界利益の計算式</h3>
        <div class="text-center">
          <p class="text-2xl md:text-3xl font-bold text-green-900 mb-4">
            限界利益 = 売上 - 変動費
          </p>
        </div>
      </div>

      <p class="text-lg md:text-xl mb-6 text-gray-700 leading-relaxed">
        限界利益とは、<strong class="text-blue-600">「売上のうち、固定費と利益に使える金額」</strong>です。
        つまり、変動費を引いた残りが、固定費の回収と利益になります。
      </p>

      <div class="bg-blue-50 p-6 rounded-lg mb-6 border-l-4 border-blue-500">
        <h3 class="text-xl md:text-2xl font-bold text-blue-700 mb-4">限界利益の内訳</h3>
        <div class="space-y-3">
          <div class="bg-white p-4 rounded">
            <p class="text-lg mb-2"><strong class="text-gray-700">売上 100円</strong></p>
            <p class="text-lg text-gray-600">↓ 変動費 40円を引く</p>
            <p class="text-lg mb-2"><strong class="text-green-700">限界利益 60円</strong></p>
            <p class="text-lg text-gray-600">→ このうち固定費に30円、残り30円が利益になる</p>
          </div>
        </div>
      </div>


      <!-- 図解：限界利益の分解 -->
      <div class="mb-8 bg-gradient-to-br from-cyan-50 to-blue-50 p-8 rounded-2xl shadow-xl">
        <h3 class="text-xl md:text-2xl font-bold mb-6 text-center text-gray-800">売上の構成要素（限界利益の分解）</h3>

        <div class="bg-white p-6 rounded-xl shadow-lg mb-6">
          <canvas id="marginalProfitChart"></canvas>
        </div>

        <div class="grid md:grid-cols-3 gap-4 mb-4">
          <div class="bg-orange-50 p-4 rounded-lg border-l-4 border-orange-500">
            <h4 class="font-bold text-orange-700 mb-2">🟧 変動費</h4>
            <p class="text-sm text-gray-700">売上に比例する費用</p>
          </div>
          <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500">
            <h4 class="font-bold text-blue-700 mb-2">🟦 固定費</h4>
            <p class="text-sm text-gray-700">売上に関係なく一定</p>
          </div>
          <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-500">
            <h4 class="font-bold text-green-700 mb-2">🟩 利益</h4>
            <p class="text-sm text-gray-700">限界利益 - 固定費</p>
          </div>
        </div>

        <div class="bg-cyan-50 border-l-4 border-cyan-500 p-4 rounded">
          <p class="text-sm text-gray-700"><strong class="text-cyan-700">💡 ポイント:</strong> 売上 = 変動費 + 固定費 + 利益 に分解できます</p>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
          const mpCtx = document.getElementById('marginalProfitChart');

          new Chart(mpCtx, {
            type: 'bar',
            data: {
              labels: ['商品A (高価格)', '商品B (中価格)', '商品C (低価格)'],
              datasets: [
                {
                  label: '変動費',
                  data: [200000, 150000, 100000],
                  backgroundColor: 'rgba(251, 146, 60, 0.8)',
                  borderColor: 'rgb(251, 146, 60)',
                  borderWidth: 2
                },
                {
                  label: '固定費',
                  data: [150000, 150000, 150000],
                  backgroundColor: 'rgba(59, 130, 246, 0.8)',
                  borderColor: 'rgb(59, 130, 246)',
                  borderWidth: 2
                },
                {
                  label: '利益',
                  data: [150000, 100000, 50000],
                  backgroundColor: 'rgba(16, 185, 129, 0.8)',
                  borderColor: 'rgb(16, 185, 129)',
                  borderWidth: 2
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: true,
              plugins: {
                legend: {
                  display: true,
                  position: 'top',
                  labels: {
                    font: { size: 14 },
                    padding: 15,
                    usePointStyle: true
                  }
                },
                tooltip: {
                  callbacks: {
                    label: function(context) {
                      return context.dataset.label + ': ' + context.parsed.y.toLocaleString() + '円';
                    },
                    footer: function(tooltipItems) {
                      let sum = 0;
                      tooltipItems.forEach(function(tooltipItem) {
                        sum += tooltipItem.parsed.y;
                      });
                      return '合計売上: ' + sum.toLocaleString() + '円';
                    }
                  }
                }
              },
              scales: {
                x: {
                  stacked: true,
                  title: {
                    display: true,
                    text: '商品',
                    font: { size: 14, weight: 'bold' }
                  }
                },
                y: {
                  stacked: true,
                  title: {
                    display: true,
                    text: '金額（円）',
                    font: { size: 14, weight: 'bold' }
                  },
                  ticks: {
                    callback: function(value) {
                      return value.toLocaleString() + '円';
                    }
                  },
                  beginAtZero: true
                }
              }
            }
          });
        </script>
      </div>

    </section>

    <section id="importance" class="mb-16 scroll-mt-24">
      <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gray-800">なぜ限界利益が重要なのか</h2>

      <div class="grid md:grid-cols-2 gap-6 mb-8">
        <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-blue-500">
          <h3 class="text-xl md:text-2xl font-bold text-blue-700 mb-3">📊 理由1：固定費の回収</h3>
          <p class="text-lg text-gray-700">
            限界利益が多いほど、固定費を早く回収できます。
            固定費を回収した後は、すべて利益になります。
          </p>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-green-500">
          <h3 class="text-xl md:text-2xl font-bold text-green-700 mb-3">💰 理由2：商品選定</h3>
          <p class="text-lg text-gray-700">
            限界利益率が高い商品を優先的に販売すべきです。
            同じ売上でも、利益の出方が全く違います。
          </p>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-orange-500">
          <h3 class="text-xl md:text-2xl font-bold text-orange-700 mb-3">💸 理由3：値引き判断</h3>
          <p class="text-lg text-gray-700">
            限界利益率を知ることで、どこまで値引きできるかがわかります。
            変動費を下回らなければ、固定費に貢献できます。
          </p>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-purple-500">
          <h3 class="text-xl md:text-2xl font-bold text-purple-700 mb-3">📈 理由4：経営戦略</h3>
          <p class="text-lg text-gray-700">
            限界利益率を改善することが、利益増加の近道です。
            値上げや変動費削減で、利益を増やせます。
          </p>
        </div>
      </div>
    </section>

    <section id="example" class="mb-16 scroll-mt-24">
      <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gray-800">具体例：商品比較</h2>

      <p class="text-lg md:text-xl mb-6 text-gray-700 leading-relaxed">
        2つの商品を比較して、限界利益の重要性を理解しましょう。
      </p>

      <div class="bg-white p-6 rounded-lg shadow-lg mb-8 border-2 border-gray-300">
        <h3 class="text-xl md:text-2xl font-bold mb-4 text-gray-800">商品A vs 商品B</h3>

        <div class="overflow-x-auto mb-4">
          <table class="w-full bg-white rounded-lg overflow-hidden">
            <thead class="bg-blue-600 text-white">
              <tr>
                <th class="px-4 py-3 text-left text-lg font-bold">項目</th>
                <th class="px-4 py-3 text-right text-lg font-bold">商品A</th>
                <th class="px-4 py-3 text-right text-lg font-bold">商品B</th>
              </tr>
            </thead>
            <tbody class="text-lg">
              <tr class="border-b border-gray-200">
                <td class="px-4 py-3 font-bold">単価</td>
                <td class="px-4 py-3 text-right">5,000円</td>
                <td class="px-4 py-3 text-right">3,000円</td>
              </tr>
              <tr class="border-b border-gray-200 bg-gray-50">
                <td class="px-4 py-3 font-bold">変動費</td>
                <td class="px-4 py-3 text-right">2,000円</td>
                <td class="px-4 py-3 text-right">2,000円</td>
              </tr>
              <tr class="border-b border-gray-200 bg-green-50">
                <td class="px-4 py-3 font-bold">限界利益</td>
                <td class="px-4 py-3 text-right text-green-600 font-bold">3,000円</td>
                <td class="px-4 py-3 text-right text-green-600 font-bold">1,000円</td>
              </tr>
              <tr class="bg-blue-50 font-bold">
                <td class="px-4 py-3">限界利益率</td>
                <td class="px-4 py-3 text-right text-blue-600">60%</td>
                <td class="px-4 py-3 text-right text-blue-600">33%</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="bg-green-50 p-4 rounded border-l-4 border-green-500">
          <h4 class="text-lg md:text-xl font-bold text-green-700 mb-2">結論</h4>
          <p class="text-lg text-green-900">
            商品Aの方が限界利益が大きいため、利益に貢献します。
            同じ売上10万円でも、商品Aなら限界利益6万円、商品Bなら限界利益3.3万円です。
          </p>
        </div>
      </div>
    </section>

    <section id="discount" class="mb-16 scroll-mt-24">
      <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gray-800">値引き判断への活用</h2>

      <p class="text-lg md:text-xl mb-6 text-gray-700 leading-relaxed">
        限界利益率を知ることで、適切な値引き判断ができます。
      </p>

      <div class="bg-white p-6 rounded-lg shadow-lg mb-8 border-2 border-gray-300">
        <h3 class="text-xl md:text-2xl font-bold mb-4 text-gray-800">値引きシミュレーション</h3>

        <div class="bg-gray-50 p-4 rounded mb-4">
          <p class="text-lg mb-2"><strong>前提：</strong>商品A（単価5,000円、変動費2,000円）</p>
        </div>

        <div class="space-y-4">
          <div class="bg-green-50 p-4 rounded border-l-4 border-green-500">
            <p class="text-lg mb-2"><strong class="text-green-700">4,000円に値引き</strong></p>
            <p class="text-lg text-green-900">限界利益 = 4,000円 - 2,000円 = 2,000円<br>
            → まだ固定費に貢献できるので、状況によってはアリ</p>
          </div>

          <div class="bg-yellow-50 p-4 rounded border-l-4 border-yellow-500">
            <p class="text-lg mb-2"><strong class="text-yellow-700">2,500円に値引き</strong></p>
            <p class="text-lg text-yellow-900">限界利益 = 2,500円 - 2,000円 = 500円<br>
            → ギリギリ固定費に貢献。利益は小さい</p>
          </div>

          <div class="bg-red-50 p-4 rounded border-l-4 border-red-500">
            <p class="text-lg mb-2"><strong class="text-red-700">1,500円に値引き（NG）</strong></p>
            <p class="text-lg text-red-900">限界利益 = 1,500円 - 2,000円 = -500円<br>
            → 変動費を下回るので赤字。売れば売るほど損失</p>
          </div>
        </div>

        <div class="mt-6 bg-blue-50 p-4 rounded">
          <h4 class="text-lg md:text-xl font-bold text-blue-700 mb-2">ルール</h4>
          <p class="text-lg text-blue-900">
            <strong>変動費を下回る値引きは絶対にNG</strong>です。
            売れば売るほど損失が増えます。
          </p>
        </div>
      </div>
    </section>

    <section id="calculator" class="mb-16 scroll-mt-24">
      <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gray-800">限界利益計算ツール</h2>

      <div class="bg-white p-6 rounded-lg shadow-lg mb-8 border-2 border-blue-500">
        <h3 class="text-xl md:text-2xl font-bold mb-4 text-blue-700">🧮 限界利益シミュレーター</h3>

        <div class="grid md:grid-cols-2 gap-4 mb-6">
          <div>
            <label class="block text-lg md:text-xl font-bold mb-2 text-gray-700">商品A 単価（円）</label>
            <input type="number" id="priceA" class="w-full border-2 border-gray-300 rounded-lg px-4 py-3 text-lg" placeholder="5000" min="0">
          </div>
          <div>
            <label class="block text-lg md:text-xl font-bold mb-2 text-gray-700">商品A 変動費（円）</label>
            <input type="number" id="variableA" class="w-full border-2 border-gray-300 rounded-lg px-4 py-3 text-lg" placeholder="2000" min="0">
          </div>
          <div>
            <label class="block text-lg md:text-xl font-bold mb-2 text-gray-700">商品B 単価（円）</label>
            <input type="number" id="priceB" class="w-full border-2 border-gray-300 rounded-lg px-4 py-3 text-lg" placeholder="3000" min="0">
          </div>
          <div>
            <label class="block text-lg md:text-xl font-bold mb-2 text-gray-700">商品B 変動費（円）</label>
            <input type="number" id="variableB" class="w-full border-2 border-gray-300 rounded-lg px-4 py-3 text-lg" placeholder="2000" min="0">
          </div>
        </div>

        <button onclick="calculateMargin()" class="bg-blue-600 text-white px-8 py-4 rounded-lg hover:bg-blue-700 w-full text-lg md:text-xl font-bold">
          計算する
        </button>

        <div id="result" class="mt-6 p-6 bg-green-50 rounded-lg hidden border-2 border-green-500">
          <h4 class="text-lg md:text-xl font-bold text-green-700 mb-4">📊 比較結果</h4>
          <div class="grid md:grid-cols-2 gap-6">
            <div class="bg-white p-4 rounded">
              <p class="text-lg font-bold text-gray-700 mb-2">商品A</p>
              <p class="text-lg">限界利益: <span class="font-bold text-green-600" id="marginA"></span></p>
              <p class="text-lg">限界利益率: <span class="font-bold text-blue-600" id="marginRateA"></span></p>
            </div>
            <div class="bg-white p-4 rounded">
              <p class="text-lg font-bold text-gray-700 mb-2">商品B</p>
              <p class="text-lg">限界利益: <span class="font-bold text-green-600" id="marginB"></span></p>
              <p class="text-lg">限界利益率: <span class="font-bold text-blue-600" id="marginRateB"></span></p>
            </div>
          </div>
          <div class="mt-4 bg-white p-4 rounded border-l-4 border-green-500">
            <p class="text-lg font-bold text-green-700" id="conclusion"></p>
          </div>
        </div>
      </div>
    </section>

    <section id="summary" class="mb-16 scroll-mt-24">
      <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gray-800">このセクションのまとめ</h2>

      <div class="bg-blue-50 p-6 rounded-lg mb-6">
        <h3 class="text-xl md:text-2xl font-bold text-blue-700 mb-4">📝 このセクションで学んだこと</h3>
        <ul class="list-disc pl-6 space-y-3 text-lg md:text-xl text-blue-900">
          <li>限界利益 = 売上 - 変動費</li>
          <li>限界利益は固定費と利益に使える金額です</li>
          <li>限界利益率が高い商品を優先すべきです</li>
          <li>値引きは変動費を下回らない範囲で行います</li>
        </ul>
      </div>

      <p class="text-lg md:text-xl mb-8 text-gray-700 leading-relaxed">
        次のセクションでは、固定費と変動費の削減について学びます。
      </p>
    </section>

    <div class="text-center">
      <a href="section-08.html" class="inline-block bg-blue-600 text-white px-8 py-4 rounded-lg hover:bg-blue-700 transition text-lg md:text-xl font-bold shadow-lg">
        次のセクションへ →
      </a>
    </div>
  </main>

  <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50">
    <button id="closeModal" class="absolute top-4 right-4 text-white text-4xl">&times;</button>
    <img id="modalImage" class="max-w-full max-h-full p-4" src="" alt="">
  </div>

  <script>
    function calculateMargin() {
      const priceA = parseFloat(document.getElementById('priceA').value);
      const variableA = parseFloat(document.getElementById('variableA').value);
      const priceB = parseFloat(document.getElementById('priceB').value);
      const variableB = parseFloat(document.getElementById('variableB').value);

      if (isNaN(priceA) || isNaN(variableA) || isNaN(priceB) || isNaN(variableB)) {
        alert('すべての項目に数値を入力してください');
        return;
      }

      const marginA = priceA - variableA;
      const marginRateA = (marginA / priceA) * 100;
      const marginB = priceB - variableB;
      const marginRateB = (marginB / priceB) * 100;

      document.getElementById('marginA').textContent = marginA.toLocaleString() + '円';
      document.getElementById('marginRateA').textContent = marginRateA.toFixed(1) + '%';
      document.getElementById('marginB').textContent = marginB.toLocaleString() + '円';
      document.getElementById('marginRateB').textContent = marginRateB.toFixed(1) + '%';

      const betterProduct = marginA > marginB ? '商品A' : marginB > marginA ? '商品B' : '両方同じ';
      document.getElementById('conclusion').textContent =
        `結論: ${betterProduct}の方が限界利益が高く、利益に貢献します。`;

      document.getElementById('result').classList.remove('hidden');
    }

    const dots = document.querySelectorAll('.dot');
    const sections = document.querySelectorAll('section[id]');
    window.addEventListener('scroll', () => {
      let current = '';
      sections.forEach(section => {
        const sectionTop = section.offsetTop;
        if (pageYOffset >= sectionTop - 200) { current = section.getAttribute('id'); }
      });
      dots.forEach(dot => {
        dot.classList.remove('active');
        if (dot.getAttribute('data-target') === current) { dot.classList.add('active'); }
      });
    });
    dots.forEach(dot => {
      dot.addEventListener('click', () => {
        const targetId = dot.getAttribute('data-target');
        const targetSection = document.getElementById(targetId);
        if (targetSection) { targetSection.scrollIntoView({ behavior: 'smooth' }); }
      });
    });
    const modal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    const closeModal = document.getElementById('closeModal');
    document.querySelectorAll('img:not(#modalImage)').forEach(img => {
      img.style.cursor = 'pointer';
      img.addEventListener('click', () => {
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        modalImage.src = img.src;
      });
    });
    closeModal.addEventListener('click', () => { modal.classList.add('hidden'); modal.classList.remove('flex'); });
    modal.addEventListener('click', (e) => { if (e.target === modal) { modal.classList.add('hidden'); modal.classList.remove('flex'); } });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { modal.classList.add('hidden'); modal.classList.remove('flex'); } });
  </script>
</body>
</html>