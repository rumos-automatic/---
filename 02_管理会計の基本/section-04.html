<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2.4 CVP分析（損益分岐点分析） | 会社事業における融資と利益の理解</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .dot-indicator {
      position: fixed;
      left: 2rem;
      top: 50%;
      transform: translateY(-50%);
      z-index: 40;
    }
    .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: #cbd5e1;
      margin: 1rem 0;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }
    .dot.active {
      background-color: #3b82f6;
      transform: scale(1.3);
    }
    .dot:hover {
      background-color: #3b82f6;
      transform: scale(1.2);
    }
    .dot-label {
      position: absolute;
      left: 2rem;
      top: 50%;
      transform: translateY(-50%);
      background-color: #1e293b;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      font-size: 0.875rem;
    }
    .dot:hover .dot-label {
      opacity: 1;
    }
    @media (max-width: 768px) {
      .dot-indicator {
        display: none;
      }
    }
    html {
      scroll-behavior: smooth;
    }
  </style>
</head>
<body class="bg-gray-50">
  <!-- ナビゲーション -->
  <nav class="bg-white shadow-md fixed top-0 left-0 right-0 z-50">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <a href="../index.html" class="text-lg md:text-xl font-bold text-blue-600 hover:text-blue-700">
        ← トップページ
      </a>
      <div class="flex gap-4">
        <a href="section-03.html" class="text-lg md:text-xl text-blue-600 hover:text-blue-700">
          ← 前のセクション
        </a>
        <a href="section-05.html" class="text-lg md:text-xl text-blue-600 hover:text-blue-700">
          次のセクション →
        </a>
      </div>
    </div>
  </nav>

  <!-- ドットインジケーター -->
  <div class="dot-indicator">
    <div class="dot active" data-target="intro">
      <div class="dot-label">損益分岐点とは</div>
    </div>
    <div class="dot" data-target="formula">
      <div class="dot-label">計算式</div>
    </div>
    <div class="dot" data-target="example">
      <div class="dot-label">具体例</div>
    </div>
    <div class="dot" data-target="usage">
      <div class="dot-label">活用場面</div>
    </div>
    <div class="dot" data-target="calculator">
      <div class="dot-label">計算ツール</div>
    </div>
    <div class="dot" data-target="summary">
      <div class="dot-label">まとめ</div>
    </div>
  </div>

  <!-- メインコンテンツ -->
  <main class="container mx-auto px-4 py-24 max-w-4xl">
    <!-- セクションタイトル -->
    <h1 class="text-5xl md:text-6xl font-bold mb-8 text-gray-800">2.4 CVP分析（損益分岐点分析）</h1>

    <p class="text-lg md:text-xl mb-12 text-gray-700 leading-relaxed">
      CVP分析（Cost-Volume-Profit Analysis）は、「いくつ売れば黒字になるか」を計算する手法です。
      経営判断の最も基本となる分析方法を学んでいきましょう。
    </p>

    <!-- 小セクション1: 損益分岐点とは -->
    <section id="intro" class="mb-16 scroll-mt-24">
      <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gray-800">損益分岐点とは</h2>

      <p class="text-lg md:text-xl mb-6 text-gray-700 leading-relaxed">
        <strong class="text-blue-600">損益分岐点（BEP: Break-Even Point）</strong>とは、
        <strong>利益がちょうどゼロになる売上高</strong>のことです。
      </p>

      <div class="bg-blue-50 p-6 rounded-lg mb-6 border-l-4 border-blue-500">
        <h3 class="text-xl md:text-2xl font-bold text-blue-700 mb-4">損益分岐点の意味</h3>
        <ul class="list-disc pl-6 space-y-3 text-lg md:text-xl text-blue-900">
          <li><strong>損益分岐点を超える</strong> → 黒字（利益が出る）</li>
          <li><strong>損益分岐点を下回る</strong> → 赤字（損失が出る）</li>
          <li><strong>損益分岐点ちょうど</strong> → 利益ゼロ（トントン）</li>
        </ul>
      </div>

      <div class="bg-yellow-50 border-l-4 border-yellow-500 p-6 mb-6 rounded-r-lg">
        <h3 class="text-xl md:text-2xl font-bold text-yellow-700 mb-3">💡 なぜ重要？</h3>
        <p class="text-lg md:text-xl text-yellow-900 mb-3">
          損益分岐点を知ることで、以下のことがわかります：
        </p>
        <ul class="list-disc pl-6 space-y-2 text-lg text-yellow-900">
          <li>最低限いくら売上が必要かがわかる</li>
          <li>目標売上を設定できる</li>
          <li>値引き可能な範囲がわかる</li>
          <li>固定費削減の効果を測定できる</li>
        </ul>
      </div>

      <!-- 図解プレースホルダー -->

      <!-- 図解：損益分岐点グラフ -->
      <div class="mb-8 bg-gradient-to-br from-purple-50 to-pink-50 p-8 rounded-2xl shadow-xl">
        <h3 class="text-xl md:text-2xl font-bold mb-6 text-center text-gray-800">損益分岐点グラフ</h3>

        <div class="bg-white p-6 rounded-xl shadow-lg mb-6">
          <canvas id="breakEvenChart"></canvas>
        </div>

        <div class="grid md:grid-cols-3 gap-4 mb-4">
          <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-500">
            <h4 class="font-bold text-green-700 mb-2">💚 売上線（緑）</h4>
            <p class="text-sm text-gray-700">販売数に比例して増加</p>
          </div>
          <div class="bg-red-50 p-4 rounded-lg border-l-4 border-red-500">
            <h4 class="font-bold text-red-700 mb-2">❤️ 総費用線（赤）</h4>
            <p class="text-sm text-gray-700">固定費+変動費の合計</p>
          </div>
          <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500">
            <h4 class="font-bold text-blue-700 mb-2">💙 損益分岐点</h4>
            <p class="text-sm text-gray-700">売上=総費用となる点</p>
          </div>
        </div>

        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
          <p class="text-sm text-gray-700"><strong class="text-yellow-700">💡 ポイント:</strong> 損益分岐点より右側が利益、左側が赤字のエリアです</p>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2"></script>
        <script>
          const bepCtx = document.getElementById('breakEvenChart');
          const units = [0, 20, 40, 60, 80, 100, 120, 140, 160];
          const pricePerUnit = 5000;
          const variableCost = 2000;
          const fixedCost = 300000;
          const bepUnits = fixedCost / (pricePerUnit - variableCost);

          new Chart(bepCtx, {
            type: 'line',
            data: {
              labels: units,
              datasets: [
                {
                  label: '売上',
                  data: units.map(x => x * pricePerUnit),
                  borderColor: 'rgb(16, 185, 129)',
                  backgroundColor: 'rgba(16, 185, 129, 0.1)',
                  borderWidth: 3,
                  tension: 0,
                  fill: false
                },
                {
                  label: '総費用（固定費+変動費）',
                  data: units.map(x => fixedCost + (x * variableCost)),
                  borderColor: 'rgb(239, 68, 68)',
                  backgroundColor: 'rgba(239, 68, 68, 0.1)',
                  borderWidth: 3,
                  tension: 0,
                  fill: false
                },
                {
                  label: '固定費',
                  data: units.map(x => fixedCost),
                  borderColor: 'rgb(156, 163, 175)',
                  backgroundColor: 'rgba(156, 163, 175, 0.05)',
                  borderWidth: 2,
                  borderDash: [5, 5],
                  tension: 0,
                  fill: false
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: true,
              interaction: {
                mode: 'index',
                intersect: false,
              },
              plugins: {
                legend: {
                  display: true,
                  position: 'top',
                  labels: {
                    font: { size: 14 },
                    padding: 15,
                    usePointStyle: true
                  }
                },
                tooltip: {
                  callbacks: {
                    label: function(context) {
                      return context.dataset.label + ': ' + context.parsed.y.toLocaleString() + '円';
                    }
                  }
                },
                annotation: {
                  annotations: {
                    line1: {
                      type: 'line',
                      xMin: bepUnits,
                      xMax: bepUnits,
                      borderColor: 'rgb(59, 130, 246)',
                      borderWidth: 3,
                      borderDash: [10, 5],
                      label: {
                        display: true,
                        content: '損益分岐点: ' + Math.round(bepUnits) + '個',
                        position: 'start',
                        backgroundColor: 'rgb(59, 130, 246)',
                        color: 'white',
                        font: {
                          size: 12,
                          weight: 'bold'
                        }
                      }
                    }
                  }
                }
              },
              scales: {
                x: {
                  title: {
                    display: true,
                    text: '販売個数',
                    font: { size: 14, weight: 'bold' }
                  },
                  ticks: {
                    callback: function(value, index) {
                      return this.getLabelForValue(value) + '個';
                    }
                  }
                },
                y: {
                  title: {
                    display: true,
                    text: '金額（円）',
                    font: { size: 14, weight: 'bold' }
                  },
                  ticks: {
                    callback: function(value) {
                      return value.toLocaleString() + '円';
                    }
                  },
                  beginAtZero: true
                }
              }
            }
          });
        </script>
      </div>

    </section>

    <!-- 小セクション2: 計算式 -->
    <section id="formula" class="mb-16 scroll-mt-24">
      <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gray-800">損益分岐点の計算式</h2>

      <p class="text-lg md:text-xl mb-6 text-gray-700 leading-relaxed">
        損益分岐点を計算するには、まず「限界利益率」を理解する必要があります。
      </p>

      <!-- 限界利益率の説明 -->
      <div class="bg-green-50 p-6 rounded-lg mb-6 border-l-4 border-green-500">
        <h3 class="text-xl md:text-2xl font-bold text-green-700 mb-4">限界利益率とは</h3>
        <p class="text-lg md:text-xl text-green-900 mb-4">
          <strong>限界利益率 = (売上 - 変動費) ÷ 売上</strong>
        </p>
        <p class="text-lg text-green-800">
          「売上のうち、固定費と利益に使える割合」を表します。
          例えば限界利益率60%なら、売上100円のうち60円が固定費と利益に使えます。
        </p>
      </div>

      <!-- 損益分岐点の計算式 -->
      <div class="bg-blue-50 p-8 rounded-lg mb-6 border-2 border-blue-500">
        <h3 class="text-xl md:text-2xl font-bold text-blue-700 mb-4 text-center">損益分岐点の計算式</h3>
        <div class="text-center space-y-4">
          <p class="text-2xl md:text-3xl font-bold text-blue-900">
            損益分岐点売上高 = 固定費 ÷ 限界利益率
          </p>
          <p class="text-xl md:text-2xl font-bold text-blue-900 mt-4">
            損益分岐点販売個数 = 損益分岐点売上高 ÷ 単価
          </p>
        </div>
      </div>

      <div class="bg-yellow-50 border-l-4 border-yellow-500 p-6 mb-6 rounded-r-lg">
        <h3 class="text-xl md:text-2xl font-bold text-yellow-700 mb-3">💡 計算の流れ</h3>
        <ol class="list-decimal pl-6 space-y-2 text-lg text-yellow-900">
          <li>限界利益を計算：売上 - 変動費</li>
          <li>限界利益率を計算：限界利益 ÷ 売上</li>
          <li>損益分岐点売上高を計算：固定費 ÷ 限界利益率</li>
          <li>損益分岐点販売個数を計算：損益分岐点売上高 ÷ 単価</li>
        </ol>
      </div>
    </section>

    <!-- 小セクション3: 具体例 -->
    <section id="example" class="mb-16 scroll-mt-24">
      <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gray-800">具体例で理解する</h2>

      <p class="text-lg md:text-xl mb-6 text-gray-700 leading-relaxed">
        実際の数値を使って、損益分岐点を計算してみましょう。
      </p>

      <div class="bg-white p-6 rounded-lg shadow-lg mb-8 border-2 border-gray-300">
        <h3 class="text-xl md:text-2xl font-bold mb-4 text-gray-800">🧮 計算例</h3>

        <div class="bg-gray-50 p-4 rounded mb-4">
          <h4 class="text-lg md:text-xl font-bold text-gray-700 mb-3">前提条件</h4>
          <ul class="list-disc pl-6 space-y-2 text-lg text-gray-700">
            <li>商品単価：<strong class="text-blue-600">5,000円</strong></li>
            <li>変動費：<strong class="text-orange-600">2,000円/個</strong></li>
            <li>固定費：<strong class="text-purple-600">月30万円</strong></li>
          </ul>
        </div>

        <div class="bg-blue-50 p-4 rounded mb-4">
          <h4 class="text-lg md:text-xl font-bold text-blue-700 mb-3">計算過程</h4>
          <div class="space-y-4 text-lg text-gray-700">
            <div>
              <p class="font-bold text-green-700 mb-2">ステップ1：限界利益を計算</p>
              <p>限界利益 = 5,000円 - 2,000円 = <strong class="text-green-600">3,000円</strong></p>
            </div>

            <div>
              <p class="font-bold text-green-700 mb-2">ステップ2：限界利益率を計算</p>
              <p>限界利益率 = 3,000円 ÷ 5,000円 = <strong class="text-green-600">0.6（60%）</strong></p>
            </div>

            <div>
              <p class="font-bold text-green-700 mb-2">ステップ3：損益分岐点売上高を計算</p>
              <p>損益分岐点売上高 = 30万円 ÷ 0.6 = <strong class="text-green-600">50万円</strong></p>
            </div>

            <div>
              <p class="font-bold text-green-700 mb-2">ステップ4：損益分岐点販売個数を計算</p>
              <p>損益分岐点販売個数 = 50万円 ÷ 5,000円 = <strong class="text-green-600">100個</strong></p>
            </div>
          </div>
        </div>

        <div class="bg-green-50 p-4 rounded">
          <h4 class="text-lg md:text-xl font-bold text-green-700 mb-2">結果</h4>
          <p class="text-lg md:text-xl text-green-900 mb-3">
            月に<strong class="text-2xl">100個</strong>売れば損益トントンになります。
          </p>
          <ul class="list-disc pl-6 space-y-2 text-lg text-green-800">
            <li>100個未満 → 赤字</li>
            <li>100個ちょうど → 利益ゼロ</li>
            <li>101個以上 → 黒字</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- 小セクション4: 活用場面 -->
    <section id="usage" class="mb-16 scroll-mt-24">
      <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gray-800">CVP分析の活用場面</h2>

      <p class="text-lg md:text-xl mb-6 text-gray-700 leading-relaxed">
        損益分岐点を知ると、さまざまな経営判断に役立ちます。
      </p>

      <!-- 活用場面1: 目標売上の設定 -->
      <div class="bg-white p-6 rounded-lg shadow-md mb-6 border-l-4 border-blue-500">
        <h3 class="text-xl md:text-2xl font-bold text-blue-700 mb-3">📊 活用場面1：目標売上の設定</h3>
        <p class="text-lg md:text-xl text-gray-700 mb-4">
          損益分岐点がわかれば、現実的な目標売上を設定できます。
        </p>
        <div class="bg-blue-50 p-4 rounded">
          <p class="text-lg text-blue-900">
            <strong>例：</strong>損益分岐点が50万円なら、安全を見て目標売上を70万円に設定する。
            これで20万円の利益を確保できます。
          </p>
        </div>
      </div>

      <!-- 活用場面2: 値引き判断 -->
      <div class="bg-white p-6 rounded-lg shadow-md mb-6 border-l-4 border-green-500">
        <h3 class="text-xl md:text-2xl font-bold text-green-700 mb-3">💸 活用場面2：値引き判断</h3>
        <p class="text-lg md:text-xl text-gray-700 mb-4">
          限界利益率を知ることで、「いくらまで値引きできるか」がわかります。
        </p>
        <div class="bg-green-50 p-4 rounded">
          <p class="text-lg text-green-900 mb-3">
            <strong>例：</strong>限界利益率60%の商品（単価5,000円、変動費2,000円）の場合：
          </p>
          <ul class="list-disc pl-6 space-y-2 text-lg text-green-800">
            <li>4,000円に値引き → 限界利益2,000円（まだ固定費に貢献）</li>
            <li>2,000円以下 → 変動費を下回るので赤字</li>
          </ul>
        </div>
      </div>

      <!-- 活用場面3: 固定費削減の効果測定 -->
      <div class="bg-white p-6 rounded-lg shadow-md mb-6 border-l-4 border-purple-500">
        <h3 class="text-xl md:text-2xl font-bold text-purple-700 mb-3">📉 活用場面3：固定費削減の効果測定</h3>
        <p class="text-lg md:text-xl text-gray-700 mb-4">
          固定費を削減すると、損益分岐点がどれだけ下がるかを計算できます。
        </p>
        <div class="bg-purple-50 p-4 rounded">
          <p class="text-lg text-purple-900 mb-3">
            <strong>例：</strong>固定費を30万円 → 24万円に削減した場合：
          </p>
          <p class="text-lg text-purple-800">
            損益分岐点売上高 = 24万円 ÷ 0.6 = 40万円<br>
            → 10万円分、売上目標を下げられる
          </p>
        </div>
      </div>
    </section>

    <!-- 小セクション5: 計算ツール -->
    <section id="calculator" class="mb-16 scroll-mt-24">
      <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gray-800">損益分岐点計算ツール</h2>

      <p class="text-lg md:text-xl mb-6 text-gray-700 leading-relaxed">
        自社の数値を入力して、損益分岐点を計算してみましょう。
      </p>

      <div class="bg-white p-6 rounded-lg shadow-lg mb-8 border-2 border-blue-500">
        <h3 class="text-xl md:text-2xl font-bold mb-4 text-blue-700">🧮 損益分岐点計算シミュレーター</h3>

        <div class="mb-4">
          <label class="block text-lg md:text-xl font-bold mb-2 text-gray-700">商品単価（円）</label>
          <input type="number" id="price" class="w-full border-2 border-gray-300 rounded-lg px-4 py-3 text-lg focus:border-blue-500 focus:outline-none" placeholder="5000" min="0">
          <p class="text-sm text-gray-600 mt-1">1個あたりの販売価格</p>
        </div>

        <div class="mb-4">
          <label class="block text-lg md:text-xl font-bold mb-2 text-gray-700">変動費（円/個）</label>
          <input type="number" id="variableCost" class="w-full border-2 border-gray-300 rounded-lg px-4 py-3 text-lg focus:border-blue-500 focus:outline-none" placeholder="2000" min="0">
          <p class="text-sm text-gray-600 mt-1">1個売るごとにかかる費用（材料費、仕入費など）</p>
        </div>

        <div class="mb-6">
          <label class="block text-lg md:text-xl font-bold mb-2 text-gray-700">固定費（円/月）</label>
          <input type="number" id="fixedCost" class="w-full border-2 border-gray-300 rounded-lg px-4 py-3 text-lg focus:border-blue-500 focus:outline-none" placeholder="300000" min="0">
          <p class="text-sm text-gray-600 mt-1">毎月必ずかかる費用（家賃、人件費、保険料など）</p>
        </div>

        <button onclick="calculateBEP()" class="bg-blue-600 text-white px-8 py-4 rounded-lg hover:bg-blue-700 w-full text-lg md:text-xl font-bold transition shadow-md">
          計算する
        </button>

        <div id="result" class="mt-6 p-6 bg-green-50 rounded-lg hidden border-2 border-green-500">
          <h4 class="text-lg md:text-xl font-bold text-green-700 mb-4">📊 計算結果</h4>
          <div class="space-y-3 mb-4">
            <div class="flex justify-between items-center border-b border-green-200 pb-2">
              <span class="text-lg text-gray-700">限界利益（1個あたり）</span>
              <span class="text-xl font-bold text-green-600" id="resultMargin"></span>
            </div>
            <div class="flex justify-between items-center border-b border-green-200 pb-2">
              <span class="text-lg text-gray-700">限界利益率</span>
              <span class="text-xl font-bold text-green-600" id="resultMarginRate"></span>
            </div>
            <div class="flex justify-between items-center border-b border-green-200 pb-2">
              <span class="text-lg text-gray-700">損益分岐点売上高</span>
              <span class="text-2xl font-bold text-blue-600" id="resultBEPSales"></span>
            </div>
            <div class="flex justify-between items-center pt-2">
              <span class="text-xl font-bold text-gray-800">損益分岐点販売個数</span>
              <span class="text-3xl font-bold text-red-600" id="resultBEPUnits"></span>
            </div>
          </div>
          <div class="bg-white p-4 rounded border-l-4 border-green-500">
            <p class="text-lg text-gray-700 mb-2">
              <strong class="text-green-700">結論：</strong>
            </p>
            <p class="text-lg text-gray-700" id="resultConclusion"></p>
          </div>
        </div>
      </div>
    </section>

    <!-- まとめ -->
    <section id="summary" class="mb-16 scroll-mt-24">
      <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gray-800">このセクションのまとめ</h2>

      <p class="text-lg md:text-xl mb-6 text-gray-700 leading-relaxed">
        CVP分析（損益分岐点分析）について、理解が深まったでしょうか？
      </p>

      <div class="bg-blue-50 p-6 rounded-lg mb-6">
        <h3 class="text-xl md:text-2xl font-bold text-blue-700 mb-4">📝 このセクションで学んだこと</h3>
        <ul class="list-disc pl-6 space-y-3 text-lg md:text-xl text-blue-900">
          <li>損益分岐点は「利益がゼロになる売上高」です</li>
          <li>損益分岐点売上高 = 固定費 ÷ 限界利益率</li>
          <li>限界利益率 = (売上 - 変動費) ÷ 売上</li>
          <li>目標売上設定、値引き判断、固定費削減の効果測定に使えます</li>
          <li>損益分岐点を下げることで、経営が安定します</li>
        </ul>
      </div>

      <p class="text-lg md:text-xl mb-8 text-gray-700 leading-relaxed">
        次のセクションでは、予算管理と実績管理について学びます。
        計画的な経営を実現するための手法を学んでいきましょう。
      </p>
    </section>

    <!-- 次のセクションへのリンク -->
    <div class="text-center">
      <a href="section-05.html" class="inline-block bg-blue-600 text-white px-8 py-4 rounded-lg hover:bg-blue-700 transition text-lg md:text-xl font-bold shadow-lg">
        次のセクションへ →
      </a>
    </div>
  </main>

  <!-- 画像拡大モーダル -->
  <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50">
    <button id="closeModal" class="absolute top-4 right-4 text-white text-4xl hover:text-gray-300 transition">&times;</button>
    <img id="modalImage" class="max-w-full max-h-full p-4" src="" alt="">
  </div>

  <!-- スクリプト -->
  <script>
    // 損益分岐点計算ツール
    function calculateBEP() {
      const price = parseFloat(document.getElementById('price').value);
      const variableCost = parseFloat(document.getElementById('variableCost').value);
      const fixedCost = parseFloat(document.getElementById('fixedCost').value);

      if (isNaN(price) || isNaN(variableCost) || isNaN(fixedCost)) {
        alert('すべての項目に数値を入力してください');
        return;
      }

      if (price <= variableCost) {
        alert('商品単価は変動費より大きくしてください');
        return;
      }

      const margin = price - variableCost;
      const marginRate = margin / price;
      const bepSales = Math.ceil(fixedCost / marginRate);
      const bepUnits = Math.ceil(bepSales / price);

      document.getElementById('resultMargin').textContent = margin.toLocaleString() + '円';
      document.getElementById('resultMarginRate').textContent = (marginRate * 100).toFixed(1) + '%';
      document.getElementById('resultBEPSales').textContent = bepSales.toLocaleString() + '円';
      document.getElementById('resultBEPUnits').textContent = bepUnits.toLocaleString() + '個';
      document.getElementById('resultConclusion').textContent =
        `月に${bepUnits.toLocaleString()}個売れば損益トントンになります。${bepUnits + 1}個以上売れば黒字です。`;
      document.getElementById('result').classList.remove('hidden');
    }

    // ドットインジケーター
    const dots = document.querySelectorAll('.dot');
    const sections = document.querySelectorAll('section[id]');

    window.addEventListener('scroll', () => {
      let current = '';
      sections.forEach(section => {
        const sectionTop = section.offsetTop;
        const sectionHeight = section.clientHeight;
        if (pageYOffset >= sectionTop - 200) {
          current = section.getAttribute('id');
        }
      });

      dots.forEach(dot => {
        dot.classList.remove('active');
        if (dot.getAttribute('data-target') === current) {
          dot.classList.add('active');
        }
      });
    });

    dots.forEach(dot => {
      dot.addEventListener('click', () => {
        const targetId = dot.getAttribute('data-target');
        const targetSection = document.getElementById(targetId);
        if (targetSection) {
          targetSection.scrollIntoView({ behavior: 'smooth' });
        }
      });
    });

    // 画像拡大機能
    const modal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    const closeModal = document.getElementById('closeModal');

    document.querySelectorAll('img:not(#modalImage)').forEach(img => {
      img.style.cursor = 'pointer';
      img.addEventListener('click', () => {
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        modalImage.src = img.src;
      });
    });

    closeModal.addEventListener('click', () => {
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    });

    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
      }
    });
  </script>
</body>
</html>